<div class="block">
  <button class="button button-fill view-question-answers">Виж отговорите на въпрос</button>
</div>


$('body').on('click', '.view-question-answers', function () {
  // Get questions from JSON again
  fetch('questions.json')
    .then(res => res.json())
    .then(questions => {
      const buttons = questions.map(q => ({
        text: `${q.number}. ${q.question}`,
        onClick: () => showAnswersForQuestion(q)
      }));

      app.actions.create({
        buttons: [
          ...buttons,
          {
            text: 'Затвори',
            color: 'red'
          }
        ]
      }).open();
    })
    .catch(err => {
      console.error('Error loading questions:', err);
      app.dialog.alert('Грешка при зареждане на въпросите.');
    });
});


function showAnswersForQuestion(question) {
  const questionKey = `question_${question.number}`;

  window.requestFileSystem(LocalFileSystem.PERSISTENT, 0, function (fs) {
    fs.root.getFile(submitFileName, {}, function (fileEntry) {
      fileEntry.file(function (file) {
        var reader = new FileReader();
        reader.onloadend = function () {
          try {
            const data = JSON.parse(this.result);
            const answers = data.map(sub => `${sub.name}: ${sub[questionKey] || 'Няма отговор'}`);
            const output = answers.join('<br><hr>') || "Няма отговори за този въпрос.";
            app.dialog.alert(output, `Отговори на: ${question.question}`);
          } catch (e) {
            app.dialog.alert("Файлът не може да се прочете.");
          }
        };
        reader.readAsText(file);
      });
    });
  }, onError);
}

